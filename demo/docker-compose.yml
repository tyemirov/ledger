services:
  ledger:
    image: ghcr.io/tyemirov/ledger:latest
    container_name: ledger-ledger
    pull_policy: always
    env_file:
      - ./.env.ledger
    volumes:
      - ledger_data:/data
    ports:
      - "50051:50051"
    restart: unless-stopped

  tauth:
    image: ghcr.io/tyemirov/tauth:latest
    container_name: ledger-tauth
    pull_policy: always
    env_file:
      - ./.env.tauth
    volumes:
      - tauth_data:/data
    ports:
      - "8080:8080"
    restart: unless-stopped

  demoapi:
    build:
      context: .
      dockerfile: Dockerfile
    image: ledger-demoapi:latest
    container_name: ledger-demoapi
    env_file:
      - ./.env.demoapi
    depends_on:
      - ledger
      - tauth
    ports:
      - "9090:9090"
    restart: unless-stopped

  ghttp:
    image: ghcr.io/tyemirov/ghttp:latest
    container_name: ledger-ghttp
    pull_policy: always
    command: ["--directory", "/data", "8000"]
    ports:
      - "8000:8000"
    volumes:
      - ./ui:/data:ro
      - ./config.js:/data/config.js:ro
    depends_on:
      - demoapi
    restart: unless-stopped

volumes:
  ledger_data:
  tauth_data:
